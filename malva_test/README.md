[![Anaconda-Server Badge](https://anaconda.org/bioconda/malva/badges/platforms.svg)](https://anaconda.org/bioconda/malva)
[![Anaconda-Server Badge](https://anaconda.org/bioconda/malva/badges/license.svg)](https://anaconda.org/bioconda/malva)

# MALVA-TEST: Workflow for testing MALVA Output

Compare the .vcf output generated by MALVA with a reference SAMPLE .vcf verifying its accuracy. 

## Install from source code

### Dependencies

To manually compile MALVA-TEST you'll need the following libraries and tools installed in your system.

* [htslib >= v1.10.2](https://github.com/samtools/htslib/tree/1.10.2)
* zlib

Use your favorite system-wide package manager to install them before compiling MALVA-TEST.

For example, on ubuntu
```shell
$ sudo apt install -y libhts-dev zlib1g-dev
```

### Download and installation

To download and compile the code run the following commands.

```shell
$ cd <path-to-malva-test>
$ make
```

## Usage
```
Usage: malva-test -t [tolerance_value] <output_malva.vcf> <sample.vcf>
Arguments(optional):
    -t                                  tolerance range match of GQ (default 0)
Positional Arguments(mandatory):
    <output_malva.vcf>                  variants file in VCF format.
    <sample.vcf>                        variants file in VCF format.
```
REQUIREMENTS: The RECORDS of <output_malva.vcf> <sample.vcf> must be of the same number and sorted. 
              Tolerance value must be between 0 and 100. 

## Example
After you compiled `malva-test`, you can test it on the example data provided:
```
./malva-test -t 10 malva.example.vcf sample.example.vcf 
```
This should take less than 1 minute to complete.

In the example the following records have been changed inside "malva.example.vcf":
- [record row #257]: Changed #CHROM (20 -> 2)
- [record row #258]: Changed #POS (60419 -> 60418)
- [record row #259]: Changed #ID (rs149529999 -> rs149529990)
- [record row #260]: Changed #REF (T -> A)
- [record row #261]: Changed #ALT (C -> G)
- [record row #262]: Changed GT in #DONOR (0/0 -> 1/0)
- [record row #263]: Changed GQ in #DONOR (0 -> 15)
- [record row #264]: Changed GQ in #DONOR (0 -> 5)

Example output:
```
Compare "malva.example.vcf" with "sample.example.vcf"

<< NOT FOUND: #CHROM 2 #POS 60343 #ID rs527639301 #REF G #ALT A #DONOR 0|0:0 >>
<< NOT FOUND: #CHROM 20 #POS 60418 #ID rs538242240 #REF A #ALT G #DONOR 0|0:0 >>
<< NOT FOUND: #CHROM 20 #POS 60479 #ID rs149529990 #REF C #ALT T #DONOR 0|0:0 >>
<< NOT FOUND: #CHROM 20 #POS 60522 #ID rs150241001 #REF A #ALT TC #DONOR 0|0:0 >>
<< NOT FOUND: #CHROM 20 #POS 60568 #ID rs533509214 #REF A #ALT G #DONOR 0|0:0 >>
<< NOT FOUND: #CHROM 20 #POS 60571 #ID rs116145529 #REF C #ALT A #DONOR 1|0:0 >>
<< NOT FOUND: #CHROM 20 #POS 60579 #ID rs569863403 #REF G #ALT A #DONOR 0|0:15 >>

Records Matched: 240, Records Processed: 247
Value of Precision: 97.166%
```
NOTE: The record row #264 is not different because it falls within the tolerance set. 

### Note
- The tool has been tested only on 64bit Linux system.

## License
MALVA-TEST is distributed under the GPL-3.0-or-later license.